"use strict";class Gallery{constructor(t={}){this.options={carouselContent:$(".carousel__content")},Object.assign(this.options,t),this.carouselContent=this.options.carouselContent,this.carouselIndex=0,this.carouselLength=this.carouselContent.children().length,this.isAnimating=!1,this.itemWidth=100/this.carouselLength,this.firstItem=$(this.carouselContent.children()[0]),this.lastItem=$(this.carouselContent.children()[this.carouselLength-1]),this.firstClone=null,this.lastClone=null}init(){this.carouselContent.css("width",100*this.carouselLength+"%"),this.carouselContent.transition({x:`${this.carouselIndex*-this.itemWidth}%`},0),$.each(this.carouselContent.children(),(t,e)=>$(e).css("width",this.itemWidth+"%")),$(".nav--left").on("click",()=>this.moveLeft()),$(".nav--right").on("click",()=>this.moveRight())}moveLeft(){if(!this.isAnimating)return this.isAnimating=!0,this.carouselIndex--,-1===this.carouselIndex?(this.lastItem.prependTo(this.carouselContent),this.carouselContent.transition({x:`${(this.carouselIndex+2)*-this.itemWidth}%`},0),this.carouselContent.transition({x:`${(this.carouselIndex+1)*-this.itemWidth}%`},1e3,"easeInOutExpo",()=>(this.carouselIndex=this.carouselLength-1,this.lastItem.appendTo(this.carouselContent),this.carouselContent.transition({x:`${this.carouselIndex*-this.itemWidth}%`},0),this.isAnimating=!1))):this.carouselContent.transition({x:`${this.carouselIndex*-this.itemWidth}%`},1e3,"easeInOutExpo",()=>this.isAnimating=!1)}moveRight(){if(!this.isAnimating)return this.isAnimating=!0,this.carouselIndex++,this.carouselContent.transition({x:`${this.carouselIndex*-this.itemWidth}%`},1e3,"easeInOutExpo",()=>(this.isAnimating=!1,this.firstClone?(this.carouselIndex=0,this.carouselContent.transition({x:`${this.carouselIndex*-this.itemWidth}%`},0),this.firstClone.remove(),this.firstClone=null,this.carouselLength=this.carouselContent.children().length,this.itemWidth=100/this.carouselLength,this.carouselContent.css("width",100*this.carouselLength+"%"),void $.each(this.carouselContent.children(),(t,e)=>$(e).css("width",this.itemWidth+"%"))):this.carouselIndex===this.carouselLength-1?(this.carouselLength++,this.itemWidth=100/this.carouselLength,this.firstClone=this.firstItem.clone(),this.firstClone.addClass("clone"),this.firstClone.appendTo(this.carouselContent),this.carouselContent.css("width",100*this.carouselLength+"%"),$.each(this.carouselContent.children(),(t,e)=>$(e).css("width",this.itemWidth+"%")),this.carouselContent.transition({x:`${this.carouselIndex*-this.itemWidth}%`},0)):void 0))}}const validationMethods={length(t,e){const s=t.value.length,i=e[0],r=e[1];let n=null;switch(i){case">":s>r||(n=`Минимальная длина поля: ${r+1}.`);break;case"<":s<r||(n=`Максимальная длина поля: ${r-1}.`);break;case">=":s>=r||(n=`Минимальная длина поля: ${r}.`);break;case"<=":s<=r||(n=`Максимальная длина поля: ${r}.`);break;case"==":s!==r&&(n=`Длина поля должна равняться: ${r} символам.`)}return n},mustContainNumbers:t=>/^\d+$/.test(t.value)?null:"Поле должно содержать только буквы",mustContainLetters:t=>/^[а-яА-Яa-zA-ZёЁ]+$/.test(t.value)?null:"Поле должно содержать только буквы",inTemplate:(t,e)=>new RegExp(e[1],"i").test(t.value)?null:`Поле должно удовлетворять шаблону: ${e[0]}.`,fieldsCompatible:(t,e)=>t.value!==document.querySelector(e[0]).value?"Поля не совпадают.":null};class Form{constructor(){this.formEl=null,this.rules=null,this.selectControlOptions=null}init(t,e,s,i){this.formEl=document.querySelector(t),this.formEl.addEventListener(e,t=>this.formSubmit(t));const r=new JSONRequest;r.getData(s,t=>this.rules=t),r.getData(i,t=>{this.selectControlOptions=t,this.fillSelects()})}formSubmit(t){this.validate()||t.preventDefault()}validate(){let t=!0;for(let e of this.rules){const s=document.querySelector(e.selector);for(let i of e.methods){const e=validationMethods[i.name](s,i.args);if(e){this.setInvalidField(s,e),t=!1;break}this.setValidField(s)}}return t}setInvalidField(t,e){const s=t.classList;s.remove("is-valid"),s.add("is-invalid");let i=t.parentNode.querySelector(".invalid-feedback");i||((i=document.createElement("div")).classList.add("invalid-feedback"),t.parentNode.appendChild(i)),i.textContent=e}setValidField(t){const e=t.classList;e.remove("is-invalid"),e.add("is-valid")}fillSelects(){for(let t of this.selectControlOptions){const e=$(t.id),s=t.content;switch(t.type){case"options":for(let t of s)e.append(`<option value="${t}">${t}</option>`);break;case"autocomplete":e.autocomplete({minLength:3,source:s})}}}}class JSONRequest{getData(t,e){$.ajax({url:t,type:"GET",dataType:"json",success:e,error:function(e){Request.showMessage("#comments",`Can't get data from ${t}`)}})}getDataFromServer(t,e){$.ajax({url:t,type:"GET",dataType:"json",success:e,error:function(t){console.log(t)}})}}class Review{constructor(t,e){this.url=t,this.errorSelector=e,this.initHandlers()}initHandlers(){$("#comments").on("click",".vanish",t=>{const e=$(t.target).attr("data-id");this.delete(e),t.preventDefault()}),$("#comments").on("click",".prove",t=>{const e=$(t.target).attr("data-id");this.submit(e),t.preventDefault()}),$("#submit").on("click",t=>{this.add($("#user-name").val(),$("#comment-text").val()),t.preventDefault()})}render(){const t=$("#comments");t.empty(),$.get(this.url,{},function(e){e.forEach(function(e){const s=t.append($("<div />",{class:"form-row mt-4 w-100"}));s.append($("<div />",{class:`alert alert-${$.parseJSON(e.approved)?"success":"warning"} form-row mt-4 w-100`}).append($("<div />",{text:"User name: "+e.user,class:"form-group col-md-7"})).append($("<div />",{text:"Comment ID: "+e.id,class:"form-group col-md-5"})).append($("<div />",{text:e.text,class:"form-group col-md-12 w-100"}))),$.parseJSON(e.approved)?s.append($("<div />",{class:"col-md-7"})):s.append($("<button />",{class:"btn btn-outline-success col-md-5 prove",type:"button","data-id":e.id,text:"Prove"})).append($("<div />",{class:"col-md-2"})),s.append($("<button />",{class:"btn btn-outline-danger col-md-5 vanish",type:"button","data-id":e.id,text:"Vanish"}))})},"json")}add(t,e){const s={user:t,text:e,approved:!1};$.ajax({type:"POST",url:this.url,data:s,success:()=>this.render(),error:()=>this.showMessage(this.errorSelector,"Sorry. An error occurred while adding the comment. Try later.","Error!")})}change(t,e,s){const i={id:s,user:t,text:e,approved:!1};if(""!==s){const t=this.url+s;$.get(t,{},e=>{$.ajax({type:"PATCH",url:t,data:i,success:()=>this.render(),error:()=>this.showMessage(this.errorSelector,"Sorry. An error occurred while changing the comment. Try later.","Error!")})},"json").fail(()=>{$.ajax({type:"POST",url:this.url,data:i,success:()=>this.render(),error:()=>this.showMessage(this.errorSelector,"Sorry. An error occurred while adding the comment. Try later.","Error!")})})}else this.add(t,e)}submit(t){$.ajax({type:"PATCH",url:this.url+t,data:{approved:!0},success:()=>this.render(),error:()=>this.showMessage(this.errorSelector,"Sorry. An error occurred while submitting the comment. Try later.","Error!")})}delete(t){$.ajax({type:"DELETE",url:this.url+t,success:()=>this.render(),error:()=>this.showMessage(this.errorSelector,"Sorry. An error occurred while deleting the comment. Try later.","Error!")})}showMessage(t,e,s){$(t).dialog({title:s}).text(e)}}$(document).ready(()=>{(new Form).init(".my-form","submit","http://localhost:3000/rules/","http://localhost:3000/selects_content/"),new Review("http://localhost:3000/comments/","#message").render(),$("#birthday").datepicker({showAnim:"bounce"}),new Gallery({carouselContent:$(".carousel__content")}).init()});
//# sourceMappingURL=main.min.js.map
